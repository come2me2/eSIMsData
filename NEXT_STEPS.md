# üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ

1. ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ eSIM Go API v2.4
2. ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ (209 —Å—Ç—Ä–∞–Ω, 1000+ —Ç–∞—Ä–∏—Ñ–æ–≤)
3. ‚úÖ API endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å eSIM Go
4. ‚úÖ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è checkout.js —Å eSIM Go API (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–ó–∞–¥–∞—á–∞:** –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ eSIM Go API

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–ú–∞–ø–ø–∏–Ω–≥ –ø–ª–∞–Ω–æ–≤ –Ω–∞ bundle name**
   - –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–∏—Å–∫–∞ bundle –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (—Å—Ç—Ä–∞–Ω–∞, –¥–∞–Ω–Ω—ã–µ, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
   - –û–±–Ω–æ–≤–∏—Ç—å checkout.js –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö bundle name –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞

2. **–û–±–Ω–æ–≤–∏—Ç—å checkout.js**
   - –ó–∞–º–µ–Ω–∏—Ç—å –º–æ–∫-–¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API –≤—ã–∑–æ–≤ –∫ `/api/esimgo/order`
   - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç eSIM Go (QR –∫–æ–¥, activation code, ICCID)
   - –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç eSIM Go**
   - –ü–æ–ª—É—á–∏—Ç—å QR –∫–æ–¥ –∏–∑ –æ—Ç–≤–µ—Ç–∞
   - –ü–æ–ª—É—á–∏—Ç—å ICCID –∏ activation code
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ –ë–î

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `checkout.js` - –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ API
- –°–æ–∑–¥–∞—Ç—å `api/orders.js` - endpoint –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

---

### 2. üíæ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–ó–∞–¥–∞—á–∞:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ "My eSIMs"

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- **Supabase** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - –±–µ—Å–ø–ª–∞—Ç–Ω–æ, SQL, –ø—Ä–æ—Å—Ç–æ
- **Vercel KV** (Redis) - –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **MongoDB Atlas** - NoSQL —Ä–µ—à–µ–Ω–∏–µ

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `orders` —Å –ø–æ–ª—è–º–∏:
   - `id`, `telegram_user_id`, `telegram_username`
   - `bundle_name`, `country_code`, `country_name`
   - `price`, `status` (pending, active, failed)
   - `iccid`, `qr_code`, `activation_code`
   - `esimgo_order_reference`, `created_at`

2. –°–æ–∑–¥–∞—Ç—å API endpoints:
   - `POST /api/orders` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
   - `GET /api/orders?userId=XXX` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. –û–±–Ω–æ–≤–∏—Ç—å `my-esims.js` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞

---

### 3. üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ (–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–ó–∞–¥–∞—á–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–æ–≤ –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏—Ö

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
1. Polling –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
2. Webhook endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç eSIM Go
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î

**–§–∞–π–ª—ã:**
- `api/esimgo/webhook.js` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhooks
- –û–±–Ω–æ–≤–∏—Ç—å `api/esimgo/status.js` –¥–ª—è polling

---

### 4. üé® –£–ª—É—á—à–µ–Ω–∏–µ UX (–ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–ó–∞–¥–∞—á–∏:**
- –ü–æ–∫–∞–∑ QR –∫–æ–¥–∞ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ eSIM
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (1-2 –¥–Ω—è)
1. ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –ø–ª–∞–Ω–æ–≤ –Ω–∞ bundle name
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å checkout.js –¥–ª—è –≤—ã–∑–æ–≤–∞ API
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –∏ –ø–æ–∫–∞–∑ QR –∫–æ–¥–∞

### –≠—Ç–∞–ø 2: –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (1 –¥–µ–Ω—å)
1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase –∏–ª–∏ –¥—Ä—É–≥—É—é –ë–î
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å API –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å my-esims.js –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤

### –≠—Ç–∞–ø 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ (1 –¥–µ–Ω—å)
1. ‚úÖ Webhook endpoint
2. ‚úÖ Polling –º–µ—Ö–∞–Ω–∏–∑–º
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üìù –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è –≠—Ç–∞–ø–∞ 1

### –®–∞–≥ 1.1: –ú–∞–ø–ø–∏–Ω–≥ –ø–ª–∞–Ω–æ–≤ –Ω–∞ bundle name

–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–∏—Å–∫–∞ bundle –≤ –∫–∞—Ç–∞–ª–æ–≥–µ:

```javascript
// –í checkout.js –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
async function findBundle(countryCode, dataAmount, duration) {
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥
    const response = await fetch(`/api/esimgo/bundles?country=${countryCode}`);
    const data = await response.json();
    
    // –ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π bundle
    const bundle = data.data.find(b => 
        b.dataAmount === dataAmount && 
        b.duration === duration
    );
    
    return bundle?.name; // –Ω–∞–ø—Ä–∏–º–µ—Ä: "esim_1GB_7D_TH_V2"
}
```

### –®–∞–≥ 1.2: –û–±–Ω–æ–≤–∏—Ç—å checkout.js

```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ setupPurchaseButton, –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
const bundleName = await findBundle(
    orderData.code, // –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã
    orderData.dataAmount, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö
    orderData.duration // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
);

if (!bundleName) {
    throw new Error('Bundle not found');
}

// –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ eSIM Go API
const orderResponse = await fetch('/api/esimgo/order', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        type: 'transaction',
        assign: true,
        order: [{
            type: 'bundle',
            quantity: 1,
            item: bundleName,
            allowReassign: false
        }]
    })
});

const orderResult = await orderResponse.json();

// –ü–æ–ª—É—á–∏—Ç—å QR –∫–æ–¥ –∏ –¥–∞–Ω–Ω—ã–µ eSIM
const assignmentsResponse = await fetch(
    `/api/esimgo/assignments?reference=${orderResult.orderReference}`
);
const assignments = await assignmentsResponse.json();

// –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥
showQRCode(assignments.qrCode);
```

### –®–∞–≥ 1.3: –ü–æ–∫–∞–∑ QR –∫–æ–¥–∞

–°–æ–∑–¥–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è QR –∫–æ–¥–∞ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–∫–∞–∑–∞ –≤ eSIM Go API

```javascript
{
    type: 'transaction', // –∏–ª–∏ 'validate' –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    assign: true, // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∏—Ç—å bundle –Ω–∞ eSIM
    order: [{
        type: 'bundle',
        quantity: 1,
        item: 'esim_1GB_7D_TH_V2', // bundle name –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
        allowReassign: false
    }]
}
```

### –û—Ç–≤–µ—Ç –æ—Ç eSIM Go

```javascript
{
    order: [{
        esims: [{
            iccid: '8944123456789012345',
            matchingId: 'A1B2-C3D4-E5F6-G7H8',
            smdpAddress: 'http://smdp.example.com'
        }]
    }],
    orderReference: '123e4567-e89b-12d3-a456-426614174000',
    status: 'completed'
}
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [eSIM Go API v2.4 Documentation](https://docs.esim-go.com/api/v2_4/)
- [OpenAPI Schema](./esim_go_schema_v2_4.yaml)
- [Storage Options](./STORAGE_OPTIONS.md)
- [Integration Plan](./ESIMGO_INTEGRATION_PLAN.md)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã

- [ ] –ò–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É bundle –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –º–∞–ø–ø–∏–Ω–≥–∞ –ø–ª–∞–Ω–æ–≤ –Ω–∞ bundle name
- [ ] –û–±–Ω–æ–≤–∏—Ç—å checkout.js –¥–ª—è –≤—ã–∑–æ–≤–∞ API
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç –∏ –ø–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

