# üîÑ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±—Ä–æ—Å—É –∏ –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é –∫—ç—à–∞ –Ω–∞ Contabo

## –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É Contabo –ø–æ SSH
ssh root@your-server-ip

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
cd /var/www/esimsdata

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
./scripts/reset-and-refill-cache.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –û—á–∏—Å—Ç–∏—Ç –≤–µ—Å—å –∫—ç—à
2. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–∏—Ç –∫—ç—à –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ HTTP endpoints

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP endpoints:

```bash
# 1. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
curl -X POST "http://your-domain.com/api/cache/refresh?secret=YOUR_SECRET&type=all"

# 2. –ü–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞
curl -X POST "http://your-domain.com/api/cache/prefill?secret=YOUR_SECRET"
```

**–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_SECRET` –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `CACHE_REFRESH_SECRET`.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ Node.js

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
cd /var/www/esimsdata

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
node scripts/refresh-cache-direct.js

# –ü–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞ (—á–µ—Ä–µ–∑ endpoint)
curl -X POST "http://localhost:3000/api/cache/prefill?secret=YOUR_SECRET"
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –í —Ñ–∞–π–ª–µ .env –∏–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö PM2
export CACHE_REFRESH_SECRET="your-secret-key-here"
export DOMAIN="your-domain.com"  # –∏–ª–∏ localhost:3000
export PROTOCOL="https"  # –∏–ª–∏ http
```

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞** (`/api/cache/refresh`):
   - –û—á–∏—â–∞–µ—Ç –∫—ç—à –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω
   - –û—á–∏—â–∞–µ—Ç –∫—ç—à –¥–ª—è Global –ø–ª–∞–Ω–æ–≤
   - –û—á–∏—â–∞–µ—Ç –∫—ç—à –¥–ª—è Region –ø–ª–∞–Ω–æ–≤ (Africa, Asia, Europe, –∏ —Ç.–¥.)
   - –û—á–∏—â–∞–µ—Ç –∫—ç—à –¥–ª—è Local –ø–ª–∞–Ω–æ–≤

2. **–ü–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞** (`/api/cache/prefill`):
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω –∏–∑ API
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç Global –ø–ª–∞–Ω—ã
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–ª–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç Local –ø–ª–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –±–∞—Ç—á–∞–º–∏)

## –õ–æ–≥–∏

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ñ–∞–π–ª:
```
/var/www/esimsdata/logs/cache-reset.log
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ —á–µ—Ä–µ–∑ cron job. –°–º. `CONTABO_CRON_SETUP.md` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ cron

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ crontab –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# –û—Ç–∫—Ä—ã—Ç—å crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
0 3 * * * /var/www/esimsdata/scripts/reset-and-refill-cache.sh >> /var/www/esimsdata/logs/cache-reset-cron.log 2>&1
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Unauthorized"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `CACHE_REFRESH_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ–∫—Ä–µ—Ç–æ–º –≤ –∑–∞–ø—Ä–æ—Å–µ

### –û—à–∏–±–∫–∞ "Connection refused"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ PM2: `pm2 list`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 3000 –æ—Ç–∫—Ä—ã—Ç

### –ö—ç—à –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/www/esimsdata/logs/cache-reset.log`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á eSIM Go (`ESIMGO_API_KEY`) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫—ç—à –∑–∞–ø–æ–ª–Ω–µ–Ω:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API
curl "http://your-domain.com/api/esimgo/countries" | jq '.data | length'
curl "http://your-domain.com/api/esimgo/plans?category=global" | jq '.data.standard | length'
```

