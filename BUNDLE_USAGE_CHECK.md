# üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è Bundle Usage

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ #aa73ec03-4bf2-4753-b6a3-17e0aca54eea (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 8583340074)

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```bash
node scripts/check-bundle-usage.js aa73ec03-4bf2-4753-b6a3-17e0aca54eea 8583340074
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ù–∞–ª–∏—á–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–∞–ª–∏—á–∏–µ ICCID –≤ –∑–∞–∫–∞–∑–µ
- ‚úÖ –î–∞–Ω–Ω—ã–µ usage –∏–∑ callback'–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ eSIM Go API
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint /api/esimgo/bundles

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∑–∞–º–µ–Ω–∏—Ç–µ ICCID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π):
```
http://localhost:3000/api/esimgo/bundles?iccid=<ICCID>
```

–ò–ª–∏ —á–µ—Ä–µ–∑ curl:
```bash
curl "http://localhost:3000/api/esimgo/bundles?iccid=<ICCID>"
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Current eSIM

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É Current eSIM –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   - `üì¶ Loading bundle usage data for ICCID: ...`
   - `‚úÖ Bundle usage data loaded: ...`
   - –ò–ª–∏ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: ICCID –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∑–∞–∫–∞–∑–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–∫–∞–∑ –Ω–µ –±—ã–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ eSIM Go –∏–ª–∏ assignments –Ω–µ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
node scripts/restore-order-and-send-qr.js aa73ec03-4bf2-4753-b6a3-17e0aca54eea 8583340074
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 2: –î–∞–Ω–Ω—ã–µ usage –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –∑–∞–∫–∞–∑–µ

**–ü—Ä–∏—á–∏–Ω–∞:** Callback –æ—Ç eSIM Go –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Callback URL –≤ eSIM Portal:
   - Account Settings -> API Details -> Callback URL
   - –£–∫–∞–∂–∏—Ç–µ: `https://your-domain.com/api/esimgo/callback`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ endpoint `/api/esimgo/callback` –¥–æ—Å—Ç—É–ø–µ–Ω
3. –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 3: Endpoint /api/esimgo/bundles –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏—á–∏–Ω–∞:** 
- ICCID –Ω–µ–≤–µ—Ä–Ω—ã–π
- eSIM –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
- Bundle –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ eSIM

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ICCID –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ eSIM Go
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ eSIM –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ bundle –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ eSIM

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 4: –î–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ UI

**–ü—Ä–∏—á–∏–Ω–∞:** 
- JavaScript –æ—à–∏–±–∫–∞
- –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ DOM
- –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ updateESimDataFromAPI

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ HTML:
   - `usageText`
   - `usageProgress`
   - `expirationText`
   - `expirationProgress`
   - `expiresDate`

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–∞
```javascript
loadCurrentESim() -> –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–∫–∞–∑ —Å ICCID -> convertOrderToESimData()
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö usage
```javascript
loadBundleUsageData(iccid) -> GET /api/esimgo/bundles?iccid=... -> updateESimDataFromAPI()
```

### 3. Endpoint /api/esimgo/bundles
- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∑–∞–∫–∞–∑–∞ (–∏–∑ callback'–∞)
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ eSIM Go API
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è UI

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
```javascript
updateESimDataFromAPI() -> –æ–±–Ω–æ–≤–ª—è–µ—Ç esimData -> –æ–±–Ω–æ–≤–ª—è–µ—Ç DOM —ç–ª–µ–º–µ–Ω—Ç—ã
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Current eSIM.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `await loadBundleUsageData(esimData.iccid)`

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—Ä–∞—É–∑–µ—Ä–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: `check-bundle-usage.js`
