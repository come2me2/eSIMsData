# MVP Release v1.0.0-mvp

**Дата релиза:** 23 декабря 2024  
**Статус:** Актуальная версия MVP

## Важно
Этот релиз является **актуальной версией MVP**. Все предыдущие версии считаются неактуальными.

## Основные компоненты

### Фронтенд
- **HTML страницы:**
  - `index.html` - Главная страница с выбором типа eSIM
  - `plans.html` - Выбор тарифа для страны
  - `region-plans.html` - Выбор тарифа для региона
  - `global-plans.html` - Глобальные тарифы
  - `region-unlimited.html` - Безлимитные тарифы для региона
  - `checkout.html` - Страница оформления заказа
  - `account.html` - Личный кабинет
  - `my-esims.html` - Мои eSIM
  - `help.html` - Помощь
  - `current-esim.html` - Текущий eSIM
  - `order-details.html` - Детали заказа

- **JavaScript файлы:**
  - `app.js` - Основная логика приложения
  - `data-loader.js` - Загрузка данных (версия v4)
  - `plans.js` - Логика выбора тарифов
  - `region-plans.js` - Логика региональных тарифов
  - `global-plans.js` - Логика глобальных тарифов
  - `region-unlimited.js` - Логика безлимитных тарифов
  - `checkout.js` - Логика оформления заказа
  - `telegram-auth.js` - Авторизация через Telegram
  - `preload.js` - Предзагрузка данных

- **Стили:**
  - `styles.css` - Основные стили приложения
  - Исправлен z-index для модальных окон (10002/10003)
  - Кнопки Next отображаются корректно на всех страницах

### Бэкенд
- **server.js** - Express.js сервер
  - Отключено кэширование для HTML, JS, CSS файлов
  - Правильная обработка статических файлов
  - API endpoints для всех функций

- **API endpoints:**
  - `/api/countries` - Список стран
  - `/api/plans` - Тарифные планы
  - `/api/orders` - Заказы
  - `/api/cache/refresh` - Обновление кэша
  - `/api/telegram/stars/*` - Telegram Stars платежи
  - `/api/admin/*` - Админ-панель

### Инфраструктура
- **Nginx конфигурация:**
  - Правильная проксировка для `/admin/`
  - Отключено кэширование HTML файлов
  - Статические файлы обрабатываются корректно

- **PM2:**
  - Приложение запущено через PM2
  - Автоматический перезапуск при сбоях

## Ключевые исправления в этом релизе

1. **Версионирование JS/CSS файлов** - Добавлены query параметры версии (`?v=20251223_1600`) для предотвращения кэширования в Telegram Mini App

2. **Отключение кэширования** - Все HTML, JS, CSS файлы отдают заголовки `no-cache` для актуальной версии в Telegram

3. **Исправление z-index** - Модальные окна (Payment method) теперь отображаются поверх кнопки Purchase

4. **Кнопки Next** - Корректно отображаются на всех страницах выбора тарифов:
   - `plans.html`
   - `region-plans.html`
   - `global-plans.html`
   - `region-unlimited.html`

5. **Кэш версия** - Обновлена до `v4` в `data-loader.js` для принудительного обновления клиентского кэша

## Технические детали

### Версионирование файлов
Все статические ресурсы загружаются с версией:
- CSS: `styles.css?v=20251223_1600`
- JS: `app.js?v=20251223_1600`, `plans.js?v=20251223_1600`, и т.д.

### Кэширование
- **HTML:** Не кэшируется (meta tags + HTTP headers)
- **JS/CSS:** Не кэшируется (HTTP headers + версионирование)
- **Статические данные:** Кэшируются на 1 год (флаги, иконки)

### Telegram Mini App
- Полная поддержка Telegram Web App API
- Haptic Feedback
- Telegram Stars для платежей
- Правильная обработка кэширования в WebView

## Развертывание

### Текущий сервер
- **IP:** 37.60.228.11
- **Путь:** `/var/www/esimsdata`
- **PM2 процесс:** `esimsdata`

### Команды для развертывания
```bash
cd /var/www/esimsdata
git pull
pm2 restart all
```

## Git тег
```bash
git tag v1.0.0-mvp
```

## Примечания
- Все предыдущие версии до этого тега считаются неактуальными
- При обновлении версионирования файлов необходимо обновить дату/время в query параметрах
- При изменении структуры данных необходимо обновить `CACHE_VERSION` в `data-loader.js`

