# –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ TMA

## üìã –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ **–¥–≤—É—Ö —É—Ä–æ–≤–Ω—è—Ö**:
1. **–°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—ç—à** (in-memory –Ω–∞ Contabo)
2. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫—ç—à** (localStorage + memory cache –≤ –±—Ä–∞—É–∑–µ—Ä–µ/TMA)

---

## üñ•Ô∏è –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—ç—à (Contabo)

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- **–§–∞–π–ª**: `/api/_lib/cache.js`
- **–¢–∏–ø**: In-memory Map (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ Node.js)
- **TTL**: 24 —á–∞—Å–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—ç—à–∞

```javascript
// –ö–ª—é—á–∏ –∫—ç—à–∞:
- `countries:all` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω
- `plans:global` - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã
- `plans:region:${region}` - –ø–ª–∞–Ω—ã –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞ (Africa, Asia, Europe, etc.)
- `plans:local:${countryCode}` - –ø–ª–∞–Ω—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã (US, GB, etc.)
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ API** (`/api/esimgo/plans`, `/api/esimgo/countries`, etc.):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫—ç—à–µ
   - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –∏ –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∏ (TTL < 24 —á–∞—Å–∞) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∏–∑ –∫—ç—à–∞
   - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–∏ ‚Üí –∑–∞–ø—Ä–æ—Å –∫ eSIM Go API ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö

2. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∏**:
   - –î–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ —Ö—Ä–∞–Ω—è—Ç—Å—è **–ë–ï–ó –Ω–∞—Ü–µ–Ω–∫–∏** (—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å)
   - –ù–∞—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **–ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ** –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–¥–º–∏–Ω–∫–∏
   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å –Ω–∞—Ü–µ–Ω–∫—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫—ç—à–∞

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞**:
   - –ß–µ—Ä–µ–∑ endpoint `/api/cache/prefill?secret=...` (—Ä—É—á–Ω–æ–µ)
   - –ß–µ—Ä–µ–∑ endpoint `/api/cache/refresh?secret=...&type=...` (—á–∞—Å—Ç–∏—á–Ω–æ–µ)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL

### API Endpoints (—Å–µ—Ä–≤–µ—Ä–Ω—ã–µ)

#### `/api/esimgo/countries`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω
- –ö—ç—à: `countries:all`
- TTL: 24 —á–∞—Å–∞

#### `/api/esimgo/plans`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `country`, `region`, `category` (global/local)
- –ö—ç—à: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - `category=global` ‚Üí `plans:global`
  - `category=local&country=US` ‚Üí `plans:local:US`
- TTL: 24 —á–∞—Å–∞

#### `/api/esimgo/region-plans`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `region` (Africa, Asia, Europe, etc.)
- –ö—ç—à: `plans:region:${region}`
- TTL: 24 —á–∞—Å–∞

---

## üì± –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫—ç—à (TMA/–ë—Ä–∞—É–∑–µ—Ä)

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- **–§–∞–π–ª**: `data-loader.js` / `public/data-loader.js`
- **–¢–∏–ø**: 
  - **Memory cache**: Map (–≤ –ø–∞–º—è—Ç–∏ JavaScript)
  - **LocalStorage cache**: localStorage –±—Ä–∞—É–∑–µ—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—ç—à–∞

```javascript
// –ü—Ä–µ—Ñ–∏–∫—Å: 'esim_cache_'
// –í–µ—Ä—Å–∏—è: 'v15' (–∏–∑–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏)
// TTL: 1 —á–∞—Å (CACHE_TTL)

// –ö–ª—é—á–∏:
- 'countries' - —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω
- 'plans_global' - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã
- 'plans_region_${regionSlug}' - –ø–ª–∞–Ω—ã —Ä–µ–≥–∏–æ–Ω–∞
- 'plans_local_${countryCode}' - –ø–ª–∞–Ω—ã —Å—Ç—Ä–∞–Ω—ã
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è **Global –ø–ª–∞–Ω–æ–≤** –∏ **Region –ø–ª–∞–Ω–æ–≤**:
1. ‚ö° **Memory cache** (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏)
2. üíæ **LocalStorage cache** (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞—Ä–µ–ª)
3. üîÑ **API endpoint** (`/api/esimgo/plans`, `/api/esimgo/region-plans`)
4. üìÅ **Static JSON file** (fallback, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

–î–ª—è **Countries**:
1. ‚ö° Memory cache
2. üíæ LocalStorage cache
3. üìÅ Static JSON file (`/data/countries.json`)
4. üîÑ API endpoint (`/api/esimgo/countries`)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞**:
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `CACHE_VERSION` (—Å–µ–π—á–∞—Å `v15`) –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª—è—é—Ç—Å—è
   - –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **Stale-while-revalidate**:
   - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ localStorage —É—Å—Ç–∞—Ä–µ–ª–∏ (TTL > 1 —á–∞—Å), –æ–Ω–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ `stale`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –≤ —Ñ–æ–Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–≤–µ–∂–∏–µ
   - –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

3. **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**:
   - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ `data-loader.js` —É–¥–∞–ª—è—é—Ç—Å—è **–í–°–ï** –∑–∞–ø–∏—Å–∏ –∫—ç—à–∞
   - –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API

4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç API –¥–ª—è –ø–ª–∞–Ω–æ–≤**:
   - Global –∏ Region –ø–ª–∞–Ω—ã **–≤—Å–µ–≥–¥–∞** –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API (–Ω–µ –∏–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤)
   - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è TMA

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `global-plans.html`)
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `data-loader.js`
3. **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**: —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ localStorage
4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `window.DataLoader.loadGlobalPlans()`
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ memory cache ‚Üí –ø—É—Å—Ç–æ
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage ‚Üí –ø—É—Å—Ç–æ (–±—ã–ª –æ—á–∏—â–µ–Ω)
7. **–ó–∞–ø—Ä–æ—Å –∫ API**: `GET /api/esimgo/plans?category=global`
8. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≤–æ–π –∫—ç—à:
   - –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –Ω–∞—Ü–µ–Ω–∫–∏
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∑–∞–ø—Ä–æ—Å –∫ eSIM Go API ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à ‚Üí –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç
9. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
   - Memory cache (–∫–ª–∏–µ–Ω—Ç)
   - LocalStorage cache (–∫–ª–∏–µ–Ω—Ç)
10. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ (–≤ —Ç–µ—á–µ–Ω–∏–µ 1 —á–∞—Å–∞)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `data-loader.js`
3. **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**: —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ (–Ω–æ —ç—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç, –µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Ç–∞ –∂–µ)
4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `window.DataLoader.loadGlobalPlans()`
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ memory cache ‚Üí **HIT** ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
6. –ò–õ–ò –ø—Ä–æ–≤–µ—Ä–∫–∞ localStorage ‚Üí **HIT** ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
7. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL (1 —á–∞—Å)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `data-loader.js`
3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `window.DataLoader.loadGlobalPlans()`
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ memory cache ‚Üí –ø—É—Å—Ç–æ
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage ‚Üí –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å, –Ω–æ `stale = true` (TTL > 1 —á–∞—Å)
6. **Stale-while-revalidate**:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
   - –í —Ñ–æ–Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API
   - –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
7. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –ù–∞—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –î–∞–Ω–Ω—ã–µ –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º –∫—ç—à–µ —Ö—Ä–∞–Ω—è—Ç—Å—è **–ë–ï–ó –Ω–∞—Ü–µ–Ω–∫–∏** (—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å)
- –ù–∞—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **–ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ** –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–¥–º–∏–Ω–∫–∏
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω—è—Ç—å –Ω–∞—Ü–µ–Ω–∫—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫—ç—à–∞

### 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫—ç—à —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –° –Ω–∞—Ü–µ–Ω–∫–æ–π
- –î–∞–Ω–Ω—ã–µ –≤ localStorage —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–∞—Ü–µ–Ω–∫—É (–ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–µ –∂–µ —Ü–µ–Ω—ã

### 3. –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ `data-loader.js` —É–¥–∞–ª—è—é—Ç—Å—è **–í–°–ï** –∑–∞–ø–∏—Å–∏ –∫—ç—à–∞
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏

### 4. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç API –¥–ª—è –ø–ª–∞–Ω–æ–≤
- Global –∏ Region –ø–ª–∞–Ω—ã **–≤—Å–µ–≥–¥–∞** –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º

### –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫—ç—à–∞

```bash
# –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å –∫—ç—à
curl "https://esimsdata.app/api/cache/prefill?secret=YOUR_SECRET"

# –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω—ã
curl "https://esimsdata.app/api/cache/refresh?secret=YOUR_SECRET&type=plans"
```

### –û—á–∏—Å—Ç–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫—ç—à–∞

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞/TMA
window.DataLoader.clearCache();
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞/TMA
window.DataLoader.getCacheStats();
```

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ `data-loader.js` —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∫—ç—à–∞
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—Å–µ–≥–¥–∞ –∂–¥—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ API
- **–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –æ—á–∏—Å—Ç–∫—É, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä—Å–∏–∏

### 2. –î–≤–æ–π–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º –∫—ç—à–µ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–∞—Ü–µ–Ω–∫—É, –æ–Ω–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã
- **–†–µ—à–µ–Ω–∏–µ**: –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ë–ï–ó –Ω–∞—Ü–µ–Ω–∫–∏

### 3. Stale –¥–∞–Ω–Ω—ã–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ (–¥–æ 1 —á–∞—Å–∞)
- **–†–µ—à–µ–Ω–∏–µ**: Stale-while-revalidate - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –≤ —Ñ–æ–Ω–µ

---

## üìä –°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å TMA
    ‚Üì
data-loader.js (–∫–ª–∏–µ–Ω—Ç)
    ‚Üì
Memory Cache ‚Üí HIT? ‚Üí –î–∞ ‚Üí –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    ‚Üì –ù–µ—Ç
LocalStorage Cache ‚Üí HIT? ‚Üí –î–∞ ‚Üí –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
    ‚Üì –ù–µ—Ç
API Request ‚Üí /api/esimgo/plans
    ‚Üì
–°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—ç—à (Contabo)
    ‚Üì
In-Memory Cache ‚Üí HIT? ‚Üí –î–∞ ‚Üí –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∏ ‚Üí –í–æ–∑–≤—Ä–∞—Ç
    ‚Üì –ù–µ—Ç
eSIM Go API ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à ‚Üí –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∏ ‚Üí –í–æ–∑–≤—Ä–∞—Ç
    ‚Üì
–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Memory + LocalStorage ‚Üí –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
```

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–£–±—Ä–∞—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –æ—á–∏—Å—Ç–∫—É**:
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä—Å–∏–∏ –∫—ç—à–∞
   - –ù–µ —É–¥–∞–ª—è—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ

2. **–£–≤–µ–ª–∏—á–∏—Ç—å TTL –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
   - Countries: –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 24 —á–∞—Å–æ–≤
   - –ü–ª–∞–Ω—ã: –æ—Å—Ç–∞–≤–∏—Ç—å 1 —á–∞—Å –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ —Ü–µ–Ω

3. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `preloadAll()` –ø—Ä–∏ idle
   - –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (countries, global plans)

4. **Service Worker –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞**:
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
   - –û—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º
