# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ –Ω–∞ Contabo VPS

–î–∞–Ω–Ω—ã–µ —Ç–∞—Ä–∏—Ñ–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ —á–µ—Ä–µ–∑ cron job –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Contabo. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—Å–µ–≥–¥–∞ –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞

–ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π cron job —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–∏—Ç—å –∫—ç—à –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—Ä–∞–∑—É –≤–∏–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã–µ:

```bash
cd /var/www/esimsdata
npm run prefill-cache
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Node.js:

```bash
cd /var/www/esimsdata
node scripts/prefill-cache.js
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∏—Ç –∏ –∑–∞–∫—ç—à–∏—Ä—É–µ—Ç:
- ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω
- ‚úÖ Global –ø–ª–∞–Ω—ã (standard –∏ unlimited)
- ‚úÖ Region –ø–ª–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ (Africa, Asia, Europe, –∏ —Ç.–¥.)
- ‚úÖ Local –ø–ª–∞–Ω—ã –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ç—Ä–∞–Ω (US, GB, DE, FR, –∏ —Ç.–¥.)

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~2-5 –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ API

## –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤

–°–∫—Ä–∏–ø—Ç—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ:
- `scripts/refresh-cache.sh` - bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è cron
- `scripts/refresh-cache-direct.js` - Node.js —Å–∫—Ä–∏–ø—Ç (fallback)

## –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É Contabo –ø–æ SSH –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd /var/www/esimsdata
chmod +x scripts/refresh-cache.sh
```

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —Ñ–∞–π–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `CACHE_REFRESH_SECRET`:

```bash
nano /var/www/esimsdata/.env
```

–î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ:
```
CACHE_REFRESH_SECRET=your-strong-secret-key-here
```

**–í–∞–∂–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron job

–û—Ç–∫—Ä–æ–π—Ç–µ crontab –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 UTC (–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è):

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 UTC
0 2 * * * cd /var/www/esimsdata && /bin/bash scripts/refresh-cache.sh >> /var/www/esimsdata/logs/cache-refresh.log 2>&1
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è**:
- `0 2 * * *` - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 UTC
- –î–ª—è –¥—Ä—É–≥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: `–º–∏–Ω—É—Ç–∞ —á–∞—Å * * *`
- –ù–∞–ø—Ä–∏–º–µ—Ä: `0 3 * * *` - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 UTC
- –ù–∞–ø—Ä–∏–º–µ—Ä: `0 2 * * 1` - –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 2:00 UTC

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ cron job –≤—Ä—É—á–Ω—É—é

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
cd /var/www/esimsdata
bash scripts/refresh-cache.sh
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
tail -f /var/www/esimsdata/logs/cache-refresh.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ HTTP endpoint

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω, –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ curl:

```bash
curl -X POST "http://localhost:3000/api/cache/refresh?secret=YOUR_SECRET&type=all"
```

–ò–ª–∏ —Å –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ–º–µ–Ω–∞:

```bash
curl -X POST "https://your-domain.com/api/cache/refresh?secret=YOUR_SECRET&type=all"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∏—Å–∫–∞ cron jobs

–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö cron jobs:

```bash
crontab -l
```

## –®–∞–≥ 6: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
```
/var/www/esimsdata/logs/cache-refresh.log
```

–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π:
```bash
tail -n 50 /var/www/esimsdata/logs/cache-refresh.log
```

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è:
```bash
grep "$(date +%Y-%m-%d)" /var/www/esimsdata/logs/cache-refresh.log
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
```bash
0 */12 * * * cd /var/www/esimsdata && /bin/bash scripts/refresh-cache.sh >> /var/www/esimsdata/logs/cache-refresh.log 2>&1
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —á–∞—Å (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
```bash
0 * * * * cd /var/www/esimsdata && /bin/bash scripts/refresh-cache.sh >> /var/www/esimsdata/logs/cache-refresh.log 2>&1
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ (UTC+3)
–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ 2:00 –ø–æ –ú–æ—Å–∫–≤–µ (23:00 UTC –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è):
```bash
0 23 * * * cd /var/www/esimsdata && /bin/bash scripts/refresh-cache.sh >> /var/www/esimsdata/logs/cache-refresh.log 2>&1
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –°–∫—Ä–∏–ø—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
   ```bash
   ls -l scripts/refresh-cache.sh
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `-rwxr-xr-x`

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ Node.js:
   ```bash
   which node
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   echo $CACHE_REFRESH_SECRET
   ```

### –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PM2 –¥–ª—è –æ—à–∏–±–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
pm2 logs
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron:
```bash
grep CRON /var/log/syslog
```

### –ö—ç—à –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:
   ```bash
   pm2 status
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ endpoint –¥–æ—Å—Ç—É–ø–µ–Ω:
   ```bash
   curl http://localhost:3000/api/cache/refresh?secret=YOUR_SECRET&type=all
   ```

3. –ï—Å–ª–∏ HTTP endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ Node.js

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: 
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `CACHE_REFRESH_SECRET` –≤ Git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É `.env` (–ø—Ä–∞–≤–∞ 600):
  ```bash
  chmod 600 /var/www/esimsdata/.env
  ```

## TTL –∫—ç—à–∞

TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏) –∫—ç—à–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 24 —á–∞—Å–∞. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –î–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 24 —á–∞—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ —á–µ—Ä–µ–∑ cron job
- –ï—Å–ª–∏ cron job –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –¥–∞–Ω–Ω—ã–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ (–Ω–æ —ç—Ç–æ –∑–∞–π–º–µ—Ç –≤—Ä–µ–º—è)

