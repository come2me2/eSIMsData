<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <title>Telegram Auth Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #F2F2F7;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 8px;
            color: #000;
        }
        
        .subtitle {
            color: #8E8E93;
            font-size: 14px;
            margin-bottom: 24px;
        }
        
        .status {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            font-weight: 500;
        }
        
        .status.success {
            background: #D1F2EB;
            color: #00695C;
            border: 1px solid #4CAF50;
        }
        
        .status.error {
            background: #FFEBEE;
            color: #B71C1C;
            border: 1px solid #F44336;
        }
        
        .status.warning {
            background: #FFF3E0;
            color: #E65100;
            border: 1px solid #FF9800;
        }
        
        .section {
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #000;
        }
        
        .data-item {
            background: #F2F2F7;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .data-label {
            color: #8E8E93;
            font-size: 12px;
            margin-bottom: 4px;
        }
        
        .data-value {
            color: #000;
            font-weight: 500;
            word-break: break-all;
        }
        
        .button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-top: 16px;
        }
        
        .button:hover {
            background: #0051D5;
        }
        
        .button:active {
            background: #0040A8;
        }
        
        .json-view {
            background: #1E1E1E;
            color: #D4D4D4;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 16px;
            color: #007AFF;
            text-decoration: none;
            font-size: 14px;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê –ù–∞–∑–∞–¥</a>
        <h1>üîê –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram</h1>
        <p class="subtitle">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Telegram SDK –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>
        
        <div id="statusContainer"></div>
        
        <div class="section">
            <div class="section-title">–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</div>
            <div id="authStatus"></div>
        </div>
        
        <div class="section">
            <div class="section-title">–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
            <div id="userData"></div>
        </div>
        
        <div class="section">
            <div class="section-title">Telegram WebApp –¥–∞–Ω–Ω—ã–µ</div>
            <div id="webAppData"></div>
        </div>
        
        <div class="section">
            <div class="section-title">–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON)</div>
            <div id="jsonData" class="json-view"></div>
        </div>
        
        <button class="button" onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button class="button" style="background: #FF9500; margin-top: 8px;" onclick="enableTestMode()">üß™ –í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</button>
        <p style="color: #8E8E93; font-size: 12px; margin-top: 8px; text-align: center;">–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º —ç–º—É–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ Telegram –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏</p>
    </div>
    
    <script src="telegram-auth.js"></script>
    <script>
        function updateStatus() {
            const auth = window.telegramAuth;
            const statusContainer = document.getElementById('statusContainer');
            const authStatus = document.getElementById('authStatus');
            const userData = document.getElementById('userData');
            const webAppData = document.getElementById('webAppData');
            const jsonData = document.getElementById('jsonData');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ SDK
            const sdkAvailable = !!window.Telegram?.WebApp;
            const authAvailable = !!auth;
            const isAuthenticated = auth?.isAuthenticated() || false;
            
            // –°—Ç–∞—Ç—É—Å
            let statusHTML = '';
            if (!sdkAvailable) {
                statusHTML = '<div class="status error">‚ùå Telegram SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram!</div>';
            } else if (!authAvailable) {
                statusHTML = '<div class="status error">‚ùå telegram-auth.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
            } else if (!isAuthenticated) {
                statusHTML = '<div class="status warning">‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram WebApp!</div>';
            } else {
                statusHTML = '<div class="status success">‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! Telegram ID –ø–æ–ª—É—á–µ–Ω.</div>';
            }
            statusContainer.innerHTML = statusHTML;
            
            // –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            authStatus.innerHTML = `
                <div class="data-item">
                    <div class="data-label">SDK –∑–∞–≥—Ä—É–∂–µ–Ω</div>
                    <div class="data-value">${sdkAvailable ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">telegram-auth.js –∑–∞–≥—Ä—É–∂–µ–Ω</div>
                    <div class="data-value">${authAvailable ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
                    <div class="data-value">${isAuthenticated ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</div>
                </div>
            `;
            
            // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (auth && isAuthenticated) {
                const user = auth.getUserData();
                userData.innerHTML = `
                    <div class="data-item">
                        <div class="data-label">Telegram ID</div>
                        <div class="data-value">${user.id || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">–ò–º—è</div>
                        <div class="data-value">${user.name || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">–ò–º—è (first_name)</div>
                        <div class="data-value">${user.first_name || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">–§–∞–º–∏–ª–∏—è (last_name)</div>
                        <div class="data-value">${user.last_name || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Username</div>
                        <div class="data-value">${user.username ? '@' + user.username : 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">–Ø–∑—ã–∫</div>
                        <div class="data-value">${user.language || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</div>
                        <div class="data-value">${user.photo ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}</div>
                    </div>
                `;
            } else {
                userData.innerHTML = '<div class="data-item"><div class="data-value" style="color: #8E8E93;">–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram WebApp.</div></div>';
            }
            
            // WebApp –¥–∞–Ω–Ω—ã–µ
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                webAppData.innerHTML = `
                    <div class="data-item">
                        <div class="data-label">–í–µ—Ä—Å–∏—è</div>
                        <div class="data-value">${tg.version || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</div>
                        <div class="data-value">${tg.platform || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">–¢–µ–º–∞</div>
                        <div class="data-value">${tg.colorScheme || 'N/A'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">initData –¥–æ—Å—Ç—É–ø–µ–Ω</div>
                        <div class="data-value">${tg.initData ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</div>
                    </div>
                `;
            } else {
                webAppData.innerHTML = '<div class="data-item"><div class="data-value" style="color: #8E8E93;">Telegram SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div></div>';
            }
            
            // JSON –¥–∞–Ω–Ω—ã–µ
            const allData = {
                sdk: {
                    available: sdkAvailable,
                    version: window.Telegram?.WebApp?.version,
                    platform: window.Telegram?.WebApp?.platform
                },
                auth: {
                    available: authAvailable,
                    authenticated: isAuthenticated,
                    userData: auth ? auth.getUserData() : null,
                    initDataUnsafe: window.Telegram?.WebApp?.initDataUnsafe || null
                }
            };
            
            jsonData.textContent = JSON.stringify(allData, null, 2);
        }
        
        function refreshData() {
            updateStatus();
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ telegram-auth.js
            setTimeout(updateStatus, 500);
        });
        
        // –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        // setInterval(updateStatus, 2000);
        
        // –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - —ç–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Telegram
        function enableTestMode() {
            // –°–æ–∑–¥–∞—ë–º —Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const testUser = {
                id: 123456789,
                first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
                last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                username: 'test_user',
                language_code: 'ru',
                photo_url: null
            };
            
            // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º telegramAuth –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            window.telegramAuth = {
                isAuthenticated: () => true,
                getUserId: () => testUser.id,
                getUserName: () => `${testUser.first_name} ${testUser.last_name}`,
                getFirstName: () => testUser.first_name,
                getLastName: () => testUser.last_name,
                getUsername: () => testUser.username,
                getLanguageCode: () => testUser.language_code,
                getUserPhoto: () => testUser.photo_url,
                getUserData: () => ({
                    id: testUser.id,
                    name: `${testUser.first_name} ${testUser.last_name}`,
                    first_name: testUser.first_name,
                    last_name: testUser.last_name,
                    username: testUser.username,
                    photo: testUser.photo_url,
                    language: testUser.language_code,
                    is_authenticated: true,
                    is_test_mode: true
                }),
                getUser: () => testUser
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateStatus();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            alert('üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á—ë–Ω!\n\n–≠—Ç–æ —ç–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Telegram –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏.\n–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ Telegram.');
        }
    </script>
</body>
</html>

